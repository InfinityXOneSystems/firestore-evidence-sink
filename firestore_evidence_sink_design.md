# Firestore Evidence Sink Design

This document outlines the design for a Firestore evidence sink, including the data schema, security rules (permissions), and a write-only ingestion model.

## Data Schema

The evidence will be stored in a top-level collection named `evidence`. Each document in this collection will represent a single piece of evidence. The document ID will be automatically generated by Firestore to ensure uniqueness and prevent hotspotting.

| Field Name | Data Type | Description |
|---|---|---|
| `timestamp` | Timestamp | The time the evidence was created. This will be set by the server. |
| `type` | String | The type of evidence (e.g., 'ci-run', 'test-result', 'vulnerability-scan'). |
| `source` | String | The source of the evidence (e.g., 'github-actions', 'jest', 'snyk'). |
| `data` | Map | The evidence payload, which can be any valid JSON object. |

### Example Document

```json
{
  "timestamp": "2026-01-09T02:20:00Z",
  "type": "ci-run",
  "source": "github-actions",
  "data": {
    "run_id": "123456789",
    "status": "success",
    "commit_sha": "abcdef1234567890"
  }
}
```

## Security Rules (Permissions)

The following security rules will be applied to the `evidence` collection to enforce a write-only ingestion model. Only authenticated services (e.g., a service account) will be allowed to create new evidence documents. Reads, updates, and deletes will be denied for all users and services.

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /evidence/{evidenceId} {
      allow create: if request.auth != null;
      allow read, update, delete: if false;
    }
  }
}
```

## Ingestion Model

Evidence will be ingested into Firestore using a write-only model. A trusted service, such as a Cloud Function or a service running on a secure server, will be responsible for writing evidence to the `evidence` collection. This service will authenticate with Firestore using a service account.

This model ensures that evidence is immutable once written, as the security rules prevent any modification or deletion of existing evidence documents.
